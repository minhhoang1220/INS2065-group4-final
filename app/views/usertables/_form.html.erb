<%= form_with(model: usertable, local: true, html: { multipart: true }) do |form| %>
  <% if usertable.errors.any? %>
    <div id="error_explanation" style="background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: 0.5rem;">
      <h2 class="text-lg font-semibold mb-3"><%= pluralize(usertable.errors.count, "error") %> prohibited this usertable from being saved:</h2>
      <ul class="list-disc leading-relaxed">
        <% usertable.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div style="display: flex; flex-direction: column; align-items: center;">
    <div style="width: 400px;">
      <%= form.label :Membership, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-left: 32px; padding-bottom: 6px;" %>
      <%= form.select :TypeMem, options_from_collection_for_select(Membership.all, 'TypeMem', 'TypeMem', selected: usertable.TypeMem), { include_blank: 'Select Membership' }, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input" %>
    </div>

    <div style="width: 400px;">
      <%= form.label :name, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.text_field :name, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input" %>
    </div>

    <div style="width: 400px;">
      <%= form.label :email, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.text_field :email, value: current_user.email, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input", readonly: true %>
    </div>

    <div style="width: 400px;">
      <%= form.label :active, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.select :active, [['Active', true], ['Inactive', false]], {}, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input" %>
    </div>

    <div style="width: 400px;">
      <%= form.label :age, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.number_field :age, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input" %>
    </div>

    <div style="width: 400px;">
      <%= form.label :gender, class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.select :gender, [['Male', 'male'], ['Female', 'female'], ['Other', 'other']], {}, style: "height: 72px; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out;", class: "form-input" %>
    </div>

    <div style="width: 400px;">
      <%= form.label :image, "Upload Image", class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px; " %>
      <div id="image-container" style="position: relative; height: 72px; min-height: 66px; padding: 0; background: #fff; border-radius: 18px; overflow: hidden; transition: all 0.3s ease;border: 1px solid #ced4da; margin-bottom: 20px;">
        <label for="usertable_image" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer; margin: 0; display: flex; justify-content: center; align-items: center;">
          <img id="image-preview" src="" alt="" style="display: none; width: 100%; height: 100%; object-fit: cover;">
          <svg id="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </label>
        <%= form.file_field :image, 
            style: "opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;",
            accept: "image/*",
            onfocus: "document.getElementById('image-container').classList.add('focused')",
            onblur: "document.getElementById('image-container').classList.remove('focused')",
            onchange: "
              const file = this.files[0];
              const preview = document.getElementById('image-preview');
              const icon = document.getElementById('upload-icon');
              const container = document.getElementById('image-container');
              
              if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                  preview.src = e.target.result;
                  preview.style.display = 'block';
                  icon.style.display = 'none';
                  container.style.height = '200px';
                  container.style.padding = '0';
                }
                reader.readAsDataURL(file);
              } else {
                preview.style.display = 'none';
                icon.style.display = 'block';
                container.style.height = '72px';
                container.style.padding = '12px 20px';
              }
            "
        %>
      </div>
    </div>

    <div style="width: 400px;">
      <%= form.label :bio, "About you", class: label_class, style: "font-weight: 600; font-size: 20px; line-height: 1.2; letter-spacing: .02rem; padding-bottom: 6px; padding-left: 32px;" %>
      <%= form.text_area :bio, 
          style: "height: auto; min-height: 66px; padding: 12px 20px; font-weight: 500; font-size: 16px; line-height: 1.5; display: block; width: 100%; outline: 0; background: #fff; color: #282828; border: 1px solid #ced4da; border-radius: 18px; margin-bottom: 20px; transition: all 0.2s ease-in-out; resize: none;  overflow: hidden;", 
          class: "form-input", 
          maxlength: 300, 
          oninput: "this.style.height = ''; this.style.height = this.scrollHeight + 'px';" 
      %>
    </div>

    <div style="width: 400px; display: flex; justify-content: center;">
      <%= form.submit "Update Profile", class: button_class(theme: 'primary'), style: "font-weight: 600; width: auto; height: 45px; border-radius: 18px; background-color: #1F98F9" %>
    </div>

    <div style="width: 400px; display: flex; justify-content: center;">
      <%= link_to "Cancel", "/usertables", style: "color: #6c757d; text-decoration: underline; width: auto; display: inline-block; text-align: center; border-radius: 18px; padding: 12px 20px;" %>
    </div>
  </div>
<% end %>

<style>
  .form-input {
    -webkit-tap-highlight-color: transparent;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  .form-input:hover:not(:focus) {
    border-color: #95A3B1 !important;
  }

  .form-input:focus {
    outline: none !important;
    border-color: #F82F6A !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
  }

  /* Loại bỏ outline mặc định của trình duyệt */
  *:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  /* Các style khác giữ nguyên */
  label {
    font-weight: bold;
    margin-bottom: 0.5rem;
    display: block;
  }

  .text-lg {
    font-size: 1.125rem;
  }

  .list-disc {
    padding-left: 1.5rem;
  }
</style>
